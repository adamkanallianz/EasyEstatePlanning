<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Estate Funding Analysis</title>
  
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">

  <style>
    :root{--font-cn: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; --primary:#0a5599; --grid:#999; --bg:#fff; --text:#000; --muted:#666; --wa-green:#25D366;}
    html,body{margin:0; padding:0; background:var(--bg); color:var(--text); font-family:var(--font-cn); -webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent;}  
    .container{max-width:850px; margin:5px auto; padding:0 12px 100px; background:#fff; position: relative;}
    
    .header{display:flex; align-items:center; justify-content:space-between; margin:0 0 8px; border-bottom: 1px solid #eee; padding-bottom: 5px;}
    .header .title{font-size:18px; font-weight:700; color:var(--primary); line-height:1.1;} 
    
    .header .actions button{margin-left:5px; padding:10px 14px; border:1px solid var(--primary); background:#fff; color:var(--primary); border-radius:6px; cursor:pointer; font-size: 13px; -webkit-appearance: none;}
    .header .actions button.primary{background:var(--primary); color:#fff;}
    
    .card{border:1px solid var(--grid); border-radius:0; padding:10px 12px; margin:8px 0; background:#fff; break-inside: avoid; page-break-inside: avoid;}
    .card h2{font-size:14px; margin:0 0 6px; line-height:1.2; text-transform: uppercase;}
    
    .row, .row-3 { display: flex; align-items: center; gap: 8px; margin: 8px 0; width: 100%; }
    .row label { width: 55%; font-size: 12px; font-weight: 500; line-height: 1.2; }
    .row input { width: 20%; }
    .row .output { width: 25%; }

    .row-3 label { width: 35%; font-size: 12px; font-weight: 500; }
    .row-3 input { width: 20%; }
    .row-3 .output { width: 25%; }
    
    input, select{box-sizing:border-box; padding:8px; border:1px solid #bbb; border-radius:4px; font-family:inherit; font-size: 16px !important; -webkit-appearance: none; appearance: none;}  
    input { text-align: right; }
    
    .output{padding:8px; background:#FFFBE6 !important; border:1px dashed #bcd; border-radius:4px; font-weight:600; font-size:13px; text-align: right; box-sizing: border-box; min-height: 38px;}
    .numeric-input{background-color:#EAFDEA !important;}
    
    ::placeholder { color: #aaa; font-size: 11px; font-weight: normal; text-align: center; }

    /* FULL COLOR PRINTING FIX */
    @media print {
      .header .actions, .fab-share { display:none !important; } 
      .container{ width: 100% !important; max-width: 100% !important; margin: 0; padding: 0; }
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
      .numeric-input { background-color: #EAFDEA !important; border: 1px solid #bbb !important; }
      .output { background-color: #FFFBE6 !important; border: 1px dashed #bcd !important; }
      .card h2 { background-color: #003366 !important; color: white !important; padding: 6px !important; }
      .blue-total { background-color: #003366 !important; color: white !important; }
      .green-total { background-color: #2e7d32 !important; color: white !important; }
      .red-total { background-color: #8B0000 !important; color: white !important; }
    }

    .fab-share{ position: fixed; right: 24px; bottom: 40px; z-index: 99999; }
    .fab-share__btn{ width: 56px; height: 56px; border-radius: 50%; border: none; cursor: pointer; background: var(--primary); color: #fff; box-shadow: 0 8px 22px rgba(0,0,0,0.2); display:flex; align-items:center; justify-content:center; -webkit-appearance: none;}
    .fab-share__list{ position: absolute; right: 0; bottom: 70px; display: none; min-width: 240px; background: #fff; border:1px solid #e6eaf0; border-radius: 12px; box-shadow: 0 10px 24px rgba(0,0,0,0.15); overflow: hidden; }
    .fab-item{ padding: 16px; cursor: pointer; border-bottom:1px solid #f2f5f9; font-size: 14px; color: #333; display: flex; align-items: center; gap: 10px; }
  </style>
</head>
<body>
  <div class="container" id="app">
    <div class="header">
      <div class="title">ESTATE FUNDING ANALYSIS<br><span style="font-size:14px;">èµ„äº§èµ„é‡‘åˆ†ææŠ¥å‘Š</span></div>
      <div class="actions" id="ui-actions">
        <button class="primary" onclick="window.print()">ğŸ–¨ Print</button>
        <button onclick="resetForm()">â†º Reset</button>
      </div>
    </div>

    <div class="card">
      <h3 style="margin-top:0; color:#003366; border-bottom: 1px solid #eee; padding-bottom:3px;">Personal Particulars / ä¸ªäººèµ„æ–™</h3>
      <div style="display:flex; gap:10px; margin-bottom: 6px;">
        <div style="flex:1.5">
          <label style="font-size:11px">Client Name & Age / å§“åä¸å¹´é¾„</label>
          <div style="display:flex; gap:5px;">
            <select id="clientTitle" style="width:25%; font-size: 13px !important;">
              <option value="">Title</option>
              <option value="Mr.">Mr.</option><option value="Ms.">Ms.</option><option value="Mdm.">Mdm.</option><option value="Dr.">Dr.</option>
              <option value="Dato'">Dato'</option><option value="Tan Sri">Tan Sri</option>
            </select>
            <input id="clientName" type="text" class="cap-input" style="width:50%; text-align: left;" placeholder="Name">
            <select id="clientAge" style="width:25%; font-size: 13px !important;">
              <option value="">Age</option>
            </select>
          </div>
        </div>
        <div style="flex:0.5">
          <label style="font-size:11px">Contact / è”ç»œ</label>
          <input id="contactNumber" type="tel" style="width:100%; text-align: left;" placeholder="+60" oninput="formatContact(this)">
        </div>
      </div>
      <div style="display:flex; gap:10px;">
        <div style="flex:1"><label style="font-size:11px">Agent Name / ä»£ç†å§“å</label><input id="agentName" type="text" class="cap-input" style="width:100%; text-align: left;" placeholder="Agent Name"></div>
        <div style="flex:1"><label style="font-size:11px">Date / æ—¥æœŸ</label><input id="date" type="date" style="width:100%; text-align: left;"></div>
      </div>
    </div>

    <div class="card">
      <h2 style="background:#003366;color:white;padding:6px;border-radius:4px">(1) Estate Administration Cost / é—äº§ç®¡ç†æˆæœ¬</h2>
      <div class="row"><label>Total Movable Assets (5%) / æ€»åŠ¨äº§èµ„äº§</label><input class="numeric-input" id="movable" type="text" inputmode="decimal" value="0"><div class="output" id="movableFee">RM 0</div></div>
      <div class="row"><label>Total Immovable Assets (10%) / æ€»ä¸åŠ¨äº§èµ„äº§</label><input class="numeric-input" id="immovable" type="text" inputmode="decimal" value="0"><div class="output" id="immovableFee">RM 0</div></div>
      <div class="row" style="border-top:1px solid #eee; padding-top:5px;"><label><b>Admin Total / ç®¡ç†è´¹ç”¨æ€»è®¡</b></label><div style="width:20%"></div><div class="output" id="adminTotal">RM 0</div></div>
    </div>

    <div class="card">
      <h2 style="background:#003366;color:white;padding:6px;border-radius:4px">(2) Settlement of Debts / å€ºåŠ¡å¿è¿˜</h2>
      <div class="row"><label>Mortgage Loan / æˆ¿äº§è´·æ¬¾</label><input class="numeric-input" id="mortgage" type="text" inputmode="decimal" value="0"><div class="output" id="mortgageOut">RM 0</div></div>
      <div class="row"><label>Personal/Other Loans / ä¸ªäººæˆ–å…¶ä»–è´·æ¬¾</label><input class="numeric-input" id="personal" type="text" inputmode="decimal" value="0"><div class="output" id="personalOut">RM 0</div></div>
      <div class="row" style="border-top:1px solid #eee; padding-top:5px;"><label><b>Debts Total / å€ºåŠ¡æ€»è®¡</b></label><div style="width:20%"></div><div class="output" id="debtTotal">RM 0</div></div>
    </div>

    <div class="card">
      <h2 style="background:#003366;color:white;padding:6px;border-radius:4px">(3) Future Family Living Expenses / æœªæ¥å®¶åº­ç”Ÿæ´»å¼€æ”¯</h2>
      <div class="row-3" style="font-size:10px; font-weight:bold; background:#f9f9f9; padding:4px 0;">
        <label>Category / ç±»åˆ«</label><label style="width:20%; text-align:center;">Monthly Fee</label><label style="width:20%; text-align:center;">Years/Qty</label><label style="width:25%; text-align:right; padding-right:10px;">Total</label>
      </div>
      <div class="row-3"><label>Household / å®¶åº­</label><input class="numeric-input" id="householdRM" type="text" inputmode="decimal" value="0"><input class="numeric-input" id="householdYears" type="text" inputmode="decimal" value="0"><div class="output" id="householdOut">RM 0</div></div>
      <div class="row-3"><label>Education / æ•™è‚²</label><input class="numeric-input" id="eduRM" type="text" inputmode="decimal" placeholder="Fee" value="0"><input class="numeric-input" id="eduQty" type="text" inputmode="decimal" placeholder="Qty" value="0"><div class="output" id="eduOut">RM 0</div></div>
      <div class="row-3"><label>Guardian / ç›‘æŠ¤</label><input class="numeric-input" id="guardianRM" type="text" inputmode="decimal" value="0"><input class="numeric-input" id="guardianYears" type="text" inputmode="decimal" value="0"><div class="output" id="guardianOut">RM 0</div></div>
      <div class="row-3"><label>Parents' Caregiver / çˆ¶æ¯èµ¡å…»è´¹</label><input class="numeric-input" id="parentRM" type="text" inputmode="decimal" value="0"><input class="numeric-input" id="parentYears" type="text" inputmode="decimal" value="0"><div class="output" id="parentOut">RM 0</div></div>
      <div class="row-3"><label>Medical / åŒ»ç–—</label><input class="numeric-input" id="medicalRM" type="text" inputmode="decimal" value="0"><input class="numeric-input" id="medicalYears" type="text" inputmode="decimal" value="0"><div class="output" id="medicalOut">RM 0</div></div>
      <div class="row-3"><label>Emergency Fund / ç´§æ€¥é¢„å¤‡é‡‘</label><input class="numeric-input" id="emergencyRM" type="text" inputmode="decimal" value="0"><input class="numeric-input" id="emergencyYears" type="text" inputmode="decimal" value="0"><div class="output" id="emergencyOut">RM 0</div></div>
      <div class="row-3">
        <div style="width: 35%; border-bottom: 1px solid #ccc;"><input type="text" placeholder="Others / å…¶ä»– (å¡«å†™)" id="othersLabel" class="cap-input" style="width: 100%; border:none; text-align: left; padding:0; font-size:12px !important;"></div>
        <input class="numeric-input" id="othersRM" type="text" inputmode="decimal" value="0"><input class="numeric-input" id="othersYears" type="text" inputmode="decimal" value="0"><div class="output" id="othersOut">RM 0</div>
      </div>
      <div class="row" style="border-top:1px solid #eee; padding-top:5px;"><label><b>Family Total / å®¶åº­æ€»è®¡</b></label><div style="width:20%"></div><div class="output" id="familyTotal">RM 0</div></div>
    </div>

    <div class="card" style="border:1px solid var(--grid);"><div class="row" style="margin:0"><label style="font-size:14px; color:#003366; width:55%"><b>(A) TOTAL FUNDING NEEDED / æ‰€éœ€æ€»èµ„é‡‘</b></label><div class="output blue-total" id="grandTotal" style="background:#003366 !important; color:white; width:45%; font-size:18px; border:none;">RM 0</div></div></div>
    
    <div class="card">
      <h2 style="background:#2e7d32;color:white;padding:6px;">Your Existing Funds / æ‚¨ç°æœ‰çš„èµ„é‡‘</h2>
      <div class="row"><label>Saving / Fixed Deposits / å‚¨è“„ä¸å®šæœŸå­˜æ¬¾</label><input class="numeric-input" id="savings" type="text" inputmode="decimal" value="0"><div class="output" id="savingsOut">RM 0</div></div>
      <div class="row"><label>EPF (Provident Fund) / å…¬ç§¯é‡‘</label><input class="numeric-input" id="epf" type="text" inputmode="decimal" value="0"><div class="output" id="epfOut">RM 0</div></div>
      <div class="row"><div style="width: 55%; border-bottom: 1px solid #ccc;"><input type="text" placeholder="Other Assets / å…¶ä»–èµ„äº§ (å¡«å†™)" id="otherFundLabel" class="cap-input" style="width: 100%; border:none; text-align: left; padding:0; font-size:12px !important;"></div><input class="numeric-input" id="otherFunds" type="text" inputmode="decimal" value="0"><div class="output" id="otherFundsOut">RM 0</div></div>
    </div>

    <div class="card" style="border:1px solid var(--grid)"><div class="row" style="margin: 0"><label style="font-size:14px; color:#2e7d32; width: 55%"><b>(B) TOTAL EXISTING FUNDS / ç°æœ‰èµ„é‡‘æ€»è®¡</b></label><div class="output green-total" id="existingTotal" style="background:#2e7d32 !important; color:white; width: 45%; font-size:18px; border:none;">RM 0</div></div></div>
    <div class="card" style="border:2px solid #8B0000; margin-top:20px;"><div class="row" style="margin: 0"><label style="font-size:15px; color:#8B0000; width: 55%"><b>(C) TOTAL FUNDING GAP (A - B) / èµ„é‡‘ç¼ºå£</b></label><div class="output red-total" id="fundingGap" style="background:#8B0000 !important; color:white; width: 45%; font-size:20px; border:none;">RM 0</div></div></div>
  </div>

  <div class="fab-share">
    <button class="fab-share__btn" id="fabBtn"><svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92z"/></svg></button>
    <div class="fab-share__list" id="fabList">
      <div class="fab-item" id="actPdf">ğŸ’¾ Save PDF / ä¿å­˜PDF</div>
   	<div class="fab-item" id="actWa">
  	<svg width="20" height="20" viewBox="0 0 448 512" fill="#25D366">
    	<path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-5.5-2.8-23.2-8.5-44.2-27.1-16.4-14.6-27.4-32.7-30.6-38.2-3.2-5.6-.3-8.6 2.5-11.3 2.5-2.5 5.5-6.5 8.3-9.7 2.8-3.2 3.7-5.5 5.6-9.2 1.9-3.7 1-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 13.2 5.7 23.5 9.2 31.6 11.8 13.3 4.2 25.4 3.6 35 2.2 10.7-1.5 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/>
  	</svg>
  	WhatsApp Summary / å‘é€æ‘˜è¦
	</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    document.querySelectorAll('.cap-input').forEach(input => {
        input.addEventListener('blur', function() {
            this.value = this.value.toLowerCase().split(' ').map(s => s.charAt(0).toUpperCase() + s.substring(1)).join(' ');
        });
    });

    const ageSelect = document.getElementById('clientAge');
    for(let i=1; i<=100; i++) {
        let opt = document.createElement('option');
        opt.value = i; opt.innerHTML = i;
        ageSelect.appendChild(opt);
    }

    function formatContact(el) {
        let val = el.value.replace(/[^\d]/g, '');
        if (val.startsWith('60')) { val = val.substring(2); }
        else if (val.startsWith('0')) { val = val.substring(1); }
        if (val.length > 0) el.value = '+60' + val;
        else el.value = '';
    }

    const fmt = (n) => 'RM ' + Math.round(n || 0).toLocaleString('en-MY');
    function val(id) {
        var el = document.getElementById(id);
        if(!el) return 0;
        return parseFloat(el.value.replace(/,/g, '')) || 0;
    }

    function calc(){
        const admin = (val('movable') * 0.05) + (val('immovable') * 0.10);
        document.getElementById('movableFee').textContent = fmt(val('movable') * 0.05);
        document.getElementById('immovableFee').textContent = fmt(val('immovable') * 0.10);
        document.getElementById('adminTotal').textContent = fmt(admin);

        const debt = val('mortgage') + val('personal');
        document.getElementById('mortgageOut').textContent = fmt(val('mortgage'));
        document.getElementById('personalOut').textContent = fmt(val('personal'));
        document.getElementById('debtTotal').textContent = fmt(debt);

        const getM = (r,y,o) => { 
          let s = val(r)*12*val(y);
          document.getElementById(o).textContent = fmt(s); 
          return s; 
        };

        const familyTotal = getM('householdRM','householdYears','householdOut') + 
                            (val('eduRM') * val('eduQty')) + 
                            getM('guardianRM','guardianYears','guardianOut') + 
                            getM('parentRM','parentYears','parentOut') + 
                            getM('medicalRM','medicalYears','medicalOut') + 
                            getM('emergencyRM','emergencyYears','emergencyOut') + // Formula refined
                            getM('othersRM','othersYears','othersOut');
        
        document.getElementById('eduOut').textContent = fmt(val('eduRM') * val('eduQty'));
        document.getElementById('familyTotal').textContent = fmt(familyTotal);
        
        const totalNeeded = admin + debt + familyTotal;
        document.getElementById('grandTotal').textContent = fmt(totalNeeded);

        const existing = val('savings') + val('epf') + val('otherFunds');
        document.getElementById('savingsOut').textContent = fmt(val('savings'));
        document.getElementById('epfOut').textContent = fmt(val('epf'));
        document.getElementById('otherFundsOut').textContent = fmt(val('otherFunds'));
        document.getElementById('existingTotal').textContent = fmt(existing);
        
        const gap = totalNeeded - existing;
        document.getElementById('fundingGap').textContent = fmt(gap > 0 ? gap : 0);
    }

    document.querySelectorAll('.numeric-input').forEach(el => {
      el.addEventListener('input', calc);
      el.addEventListener('blur', function() {
        var v = val(el.id);
        if(v !== 0 || el.value !== '') el.value = v.toLocaleString('en-US');
      });
      el.addEventListener('focus', function() {
        var v = val(el.id);
        el.value = (v === 0) ? '' : v.toString();
      });
    });

    document.getElementById('actPdf').onclick = (e) => {
      const name = document.getElementById('clientName').value || "Client";
      const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
      const actions = document.getElementById('ui-actions');
      actions.style.display = 'none';

      html2pdf().set({
        margin: [5, 5],
        filename: `${name}_EP_${date}.pdf`,
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      }).from(document.getElementById('app')).save().then(() => actions.style.display = 'flex');
    };

    document.getElementById('actWa').onclick = (e) => {
        const title = document.getElementById('clientTitle').value;
        const name = document.getElementById('clientName').value || "Client";
        const age = document.getElementById('clientAge').value;
        const clientStr = `${title} ${name}`;
        const agent = document.getElementById('agentName').value || "{Agent Name}";
        const phone = document.getElementById('contactNumber').value.replace(/[^\d]/g, '');
        const otherAssetLabel = document.getElementById('otherFundLabel').value || "Other Assets / å…¶ä»–èµ„äº§";

        const msg = `Hi ${clientStr},\n\n` +
                    `Summary of your Estate Planning Funding Analysis by ${agent}:\n` +
                    `æ‚¨çš„é—äº§è§„åˆ’èµ„é‡‘åˆ†ææŠ¥å‘Šæ‘˜è¦ï¼š\n\n` +
                    `*(A) TOTAL FUNDING NEEDED / æ‰€éœ€æ€»èµ„é‡‘* = ${document.getElementById('grandTotal').innerText}\n` +
                    `1. Admin Fee / ç®¡ç†è´¹ = ${document.getElementById('adminTotal').innerText}\n` +
                    `2. Total Debts / å€ºåŠ¡æ€»è®¡ = ${document.getElementById('debtTotal').innerText}\n` +
                    `3. Living Expenses / ç”Ÿæ´»è´¹æ€»è®¡ = ${document.getElementById('familyTotal').innerText}\n\n` +
                    `*(B) TOTAL EXISTING FUNDS / ç°æœ‰èµ„é‡‘æ€»è®¡* = ${document.getElementById('existingTotal').innerText}\n` +
                    `1. Saving & FD / å‚¨è“„ä¸å®šå­˜ = ${document.getElementById('savingsOut').innerText}\n` +
                    `2. EPF / å…¬ç§¯é‡‘ = ${document.getElementById('epfOut').innerText}\n` +
                    `3. ${otherAssetLabel} = ${document.getElementById('otherFundsOut').innerText}\n\n` +
                    `*(C) TOTAL FUNDING GAP (A - B) / èµ„é‡‘ç¼ºå£*\n` +
                    `= *${document.getElementById('fundingGap').innerText}*\n\n` +
                    `Feel free to let me know if you have any questions. ğŸ˜Š\n` +
                    `å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶ä¸æˆ‘è”ç³»ã€‚ğŸ˜Š`;

        window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
    };

    document.getElementById('fabBtn').onclick = (e) => {
        e.stopPropagation();
        const list = document.getElementById('fabList');
        list.style.display = (list.style.display === 'block') ? 'none' : 'block';
    };
    
    window.onclick = () => document.getElementById('fabList').style.display = 'none';
    window.onload = () => { document.getElementById('date').valueAsDate = new Date(); calc(); };
    function resetForm(){ if(confirm("Reset all data? / æ˜¯å¦é‡ç½®æ‰€æœ‰æ•°æ®ï¼Ÿ")) location.reload(); }
  </script>
</body>
</html>